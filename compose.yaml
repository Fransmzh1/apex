name: apex

services:
  db:
    image: container-registry.oracle.com/database/express:21.3.0-xe
    container_name: oracle-xe
    hostname: dbxe
    restart: unless-stopped
    environment:
      - ORACLE_PWD=Oracle123
      - APX_PWD=Mustika_Jay4
      - ORACLE_CHARACTERSET=AL32UTF8
    volumes:
      - oradata:/opt/oracle/oradata
      # scripts to run ORacle APEX. make sure all sh file is executable by all users
      - /home/frans/oracle/scripts/apex/24.2.0/apex:/opt/oracle/scripts/apex
      - ./dbxe/scripts/01_execApex.sh:/opt/oracle/scripts/startup/01_execApex.sh
      - ./dbxe/scripts/checkAPEXStatus.sh:/opt/oracle/checkAPEXStatus.sh:rwx
    ports:
      - "11521:1521"
    networks:
      - oracle-network
    healthcheck:
      test: ["CMD", "/opt/oracle/checkAPEXStatus.sh"]
      interval: 30s
      timeout: 10s
      retries: 10
      start_period: 30s

  oracle-ords:
    image: container-registry.oracle.com/database/ords:25.0.0
    container_name: oracle-ords
    hostname: oracle-ords
    restart: unless-stopped
    environment:
      - ORACLE_HOST=oracle-xe
      - ORACLE_PORT=1521
      - ORACLE_SERVICE=XEPDB1
      - ORACLE_PWD=Oracle123
      - ORDS_PWD=Oracle123
      - ORDS_MODE=standalone
      - STANDALONE_HTTP_PORT=8080
    volumes:
      - ords-config:/opt/oracle/ords/config
      - ./apex-scripts:/opt/oracle/scripts/apex:ro
    ports:
      - "8080:8080"
    depends_on:
      db:
        condition: service_healthy
    networks:
      - oracle-network
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8080/ords"]
      interval: 30s
      timeout: 10s
      retries: 10
      start_period: 60s

volumes:
  oradata:
    driver: local
  ords-config:
    driver: local

networks:
  oracle-network:
    driver: bridge
