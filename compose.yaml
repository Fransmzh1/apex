name: apex

services:

  db:
    image: fransmzh/apexdb:2.0
    container_name: oracle-xe
    hostname: dbxe
    restart: unless-stopped
    environment:
      - ORACLE_PWD=Oracle123
      - APX_PWD=Mustika_jay4
    volumes:
      - oradata:/opt/oracle/oradata
      - ./tunnel:/opt/tunnel:rw
    ports:
      - "11521:1521"
    networks:
      - oracle-network

  oracle-ords:
    image: fransmzh/ords:1.0
    build: ./ords
    container_name: ora-ords
    hostname: oracle-ords
    restart: unless-stopped
    environment:
      - ORACLE_HOST=dbxe
      - ORACLE_PORT=1521
      - ORACLE_SERVICE=XEPDB1
      - ORACLE_PWD=Oracle123
    volumes:
      - ords-config:/opt/ords_config
      - ./tunnel:/opt/tunnel:rw
    ports:
      - "8080:8080"
    depends_on:
      db:
        condition: service_healthy
    networks:
      - oracle-network
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8080/ords"]
      interval: 15s
      timeout: 10s
      retries: 6
      start_period: 10s
    command: bash -c "/opt/setup_ords.sh"

volumes:
  oradata:
    driver: local
  ords-config:
    driver: local

networks:
  oracle-network:
    driver: bridge
